---
dependency:
  name: galaxy
driver:
  name: docker
platforms:
  - name: instance
    # Use an image specifically built for running Docker-in-Docker while being as similar as possible to DSM 7.2.
    image: ghcr.io/jaxzin/docker-dsm7-ansible:v7.2.2-dind
    # Use a pre-built image to speed up testing
    pre_build_image: true

    # This is the most critical setting. It grants the container
    # extended kernel privileges required to run a nested Docker daemon.
    privileged: true
    # A best practice for DinD to avoid potential issues with
    # overlay filesystems nesting.
    command: --storage-driver=vfs
provisioner:
  name: ansible
verifier:
  name: ansible